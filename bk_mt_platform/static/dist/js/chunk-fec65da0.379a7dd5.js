(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fec65da0"],{"0631":function(e,t,n){"use strict";var a=n("ad0e"),i=n.n(a);i.a},4678:function(e,t,n){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"73332","./en-il.js":"73332","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df48","./fa.js":"8df48","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b46","./gd.js":"f6b46","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function i(e){var t=s(e);return n(t)}function s(e){var t=a[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}i.keys=function(){return Object.keys(a)},i.resolve=s,e.exports=i,i.id="4678"},"82a7":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix"},[n("div",{staticClass:"table-head-container"},[n("div",{staticStyle:{float:"left"},attrs:{align:"left"}},[n("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("\n            注册任务\n          ")]),e._v(" "),e._e(),e._v(" "),n("p",{staticStyle:{"padding-left":"20px",display:"inline","font-size":"13px",color:"#999"}},[e._v(e._s(e.currentTotal)+"个中\n            "+e._s(e.multipleSelectionCount)+" 个被选中")])],1),e._v(" "),n("div",{staticClass:"right-menu",attrs:{align:"right"}},[n("div",{staticClass:"header-search",class:{show:e.show}},[n("svg-icon",{attrs:{"class-name":"search-icon","icon-class":"search"},on:{click:function(t){return t.stopPropagation(),e.click(t)}}}),e._v(" "),n("el-input",{ref:"headerSearchSelect",staticClass:"header-search-select",attrs:{placeholder:"搜索"},model:{value:e.search_value,callback:function(t){e.search_value=t},expression:"search_value"}})],1),e._v(" "),n("el-button",{staticClass:"header-refresh",attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.handleRefresh}}),e._v(" "),n("el-dropdown",{staticStyle:{bottom:"5px"},attrs:{"hide-on-click":!1}},[n("el-button",{staticClass:"header-outline",attrs:{icon:"el-icon-more-outline",circle:""}}),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.id,callback:function(t){e.$set(e.column_rules,"id",t)},expression:"column_rules.id"}},[e._v("ID")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.job_uuid,callback:function(t){e.$set(e.column_rules,"job_uuid",t)},expression:"column_rules.job_uuid"}},[e._v("任务ID")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.title,callback:function(t){e.$set(e.column_rules,"title",t)},expression:"column_rules.title"}},[e._v("任务名")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.module,callback:function(t){e.$set(e.column_rules,"module",t)},expression:"column_rules.module"}},[e._v("模块")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.username,callback:function(t){e.$set(e.column_rules,"username",t)},expression:"column_rules.username"}},[e._v("执行用户")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.script_name,callback:function(t){e.$set(e.column_rules,"script_name",t)},expression:"column_rules.script_name"}},[e._v("脚本名")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.create_time,callback:function(t){e.$set(e.column_rules,"create_time",t)},expression:"column_rules.create_time"}},[e._v("创建时间")])],1)],1)],1)],1)]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"datatable",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"header-cell-style":{background:"#f2f2f2",padding:"10px 0 10px 5px",color:"#666","font-size":"14px","font-weight":400},"cell-style":{padding:"7px 0 7px 5px",color:"#666","font-size":"14px","font-weight":400}},on:{"sort-change":e.sortChange,"filter-change":e.handleFilterChange,"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"48"}}),e._v(" "),e.column_rules.id?n("el-table-column",{attrs:{sortable:"",prop:"id",label:"ID",width:"80"}}):e._e(),e._v(" "),e.column_rules.job_uuid?n("el-table-column",{attrs:{sortable:"",prop:"job_uuid",label:"任务ID",width:"300"}}):e._e(),e._v(" "),e.column_rules.title?n("el-table-column",{attrs:{prop:"title",label:"任务名",width:"300"}}):e._e(),e._v(" "),e.column_rules.module?n("el-table-column",{attrs:{prop:"module",label:"模块",width:"220"}}):e._e(),e._v(" "),e.column_rules.username?n("el-table-column",{attrs:{prop:"username",label:"执行账户",width:"100"}}):e._e(),e._v(" "),e.column_rules.script_name?n("el-table-column",{attrs:{prop:"script_name",label:"脚本名",width:"180"}}):e._e(),e._v(" "),e.column_rules.create_time?n("el-table-column",{attrs:{sortable:"",prop:"create_time",label:"创建时间"}}):e._e(),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(n){return e.handleEdit(t)}}},[e._v("编辑\n            ")]),e._v(" "),n("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(n){return e.handleScriptEdit(t)}}},[e._v("\n              脚本\n            ")]),e._v(" "),e._e()]}}])})],1),e._v(" "),n("div",{staticStyle:{height:"50px","margin-bottom":"10px",padding:"10px","line-height":"22px","border-radius":"0 0 4px 4px","border-color":"#dfe6ec","border-width":"0 1px 1px 1px","border-style":"solid"}},[n("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total, jumper","current-page":e.currentPage,"page-sizes":[5,10,15,20],"page-size":e.pageSize,total:e.currentTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),n("el-dialog",{staticClass:"script_dialog",attrs:{"close-on-click-modal":!1,visible:e.dialogScriptVisible,title:"脚本编辑"},on:{"update:visible":function(t){e.dialogScriptVisible=t}}},[[n("codemirror",{staticClass:"CodeMirror",attrs:{options:e.cmOptions},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],e._v(" "),n("div",{staticStyle:{"text-align":"right","margin-top":"20px"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogScriptVisible=!1}}},[e._v("\n            取消\n          ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmScript}},[e._v("\n            确认\n          ")])],1)],2)],1),e._v(" "),n("JobEdit",{ref:"job_edit",on:{dataRefresh:e.handleRefresh}})],1)],1)},i=[],s=n("5d73"),r=n.n(s),o=(n("96cf"),n("3b8d")),l=n("cebc"),c=n("2f62"),u=n("8f1a"),d=n("09ac"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.dialogVisible,title:"编辑","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},open:e.handleDialogOpen,close:e.handleDialogClose}},[n("el-form",{ref:"ruleForm",attrs:{model:e.settingInfo,rules:e.rules,"label-width":"80px"}},[n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"任务名",prop:"title"}},[n("el-input",{attrs:{disabled:!0,placeholder:"标题"},model:{value:e.settingInfo.title,callback:function(t){e.$set(e.settingInfo,"title",t)},expression:"settingInfo.title"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"模块",prop:"module"}},[n("el-input",{attrs:{disabled:!0,placeholder:"模块"},model:{value:e.settingInfo.module,callback:function(t){e.$set(e.settingInfo,"module",t)},expression:"settingInfo.module"}})],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"执行账户",prop:"username"}},[n("el-input",{attrs:{placeholder:"执行账户"},model:{value:e.settingInfo.username,callback:function(t){e.$set(e.settingInfo,"username",t)},expression:"settingInfo.username"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"脚本名",prop:"script_name"}},[n("el-input",{attrs:{disabled:!0,placeholder:""},model:{value:e.settingInfo.script_name,callback:function(t){e.$set(e.settingInfo,"script_name",t)},expression:"settingInfo.script_name"}})],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"回调地址",prop:"callback"}},[n("el-input",{attrs:{placeholder:"回调地址"},model:{value:e.settingInfo.callback,callback:function(t){e.$set(e.settingInfo,"callback",t)},expression:"settingInfo.callback"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"创建时间",prop:"create_time"}},[n("el-input",{attrs:{disabled:!0,placeholder:"创建时间"},model:{value:e.settingInfo.create_time,callback:function(t){e.$set(e.settingInfo,"create_time",t)},expression:"settingInfo.create_time"}})],1)],1)],1)],1),e._v(" "),n("div",{staticClass:"table-head-container"},[n("div",{staticStyle:{float:"left"},attrs:{align:"left"}},[n("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary",plain:""},on:{click:e.handleAddHost}},[e._v("\n        添加主机\n      ")])],1),e._v(" "),n("div",{staticClass:"right-menu",attrs:{align:"right"}},[n("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.searchHost,callback:function(t){e.searchHost=t},expression:"searchHost"}})],1)]),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.hostTableData,"header-cell-style":{background:"#f2f2f2",padding:"10px 0 10px 5px",color:"#666","font-size":"14px","font-weight":400},"cell-style":{padding:"7px 0 7px 5px",color:"#666","font-size":"14px","font-weight":400}}},[n("el-table-column",{attrs:{prop:"bk_cloud_id",label:"区域ID",width:"180"}}),e._v(" "),n("el-table-column",{attrs:{prop:"ip",label:"IP地址"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(n){return e.handleHostDelete(t)}}},[e._v("删除\n        ")])]}}])})],1),e._v(" "),n("div",{staticStyle:{height:"50px","margin-bottom":"10px",padding:"10px","line-height":"22px","border-radius":"0 0 4px 4px","border-color":"#dfe6ec","border-width":"0 1px 1px 1px","border-style":"solid"}},[n("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total, jumper","current-page":e.currentHostPage,"page-sizes":[5],"page-size":e.pageHostSize,total:e.currentHostTotal},on:{"current-change":e.handleHostCurrentChange}})],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("\n      取消\n    ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmSetting}},[e._v("\n      确认\n    ")])],1),e._v(" "),n("IpSelect",{ref:"ip_select",attrs:{"append-to-body":!0},on:{pick:e.handlePickIp}})],1)},p=[],f=n("f499"),b=n.n(f),m=(n("7514"),n("4917"),n("3b2b"),n("5176")),g=n.n(m),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{"append-to-body":e.appendToBody,"close-on-click-modal":!1,visible:e.visible,title:"选择服务器"},on:{"update:visible":function(t){e.visible=t},open:function(t){return e.handleOpen()}}},[n("el-tabs",{model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[n("el-tab-pane",{attrs:{label:"通过IP选择",name:"ip"}},[n("div",{staticClass:"datatable-head-container",staticStyle:{margin:"0"}},[n("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.selectAll}},[e._v("跨页全选")]),e._v(" "),n("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.clearSelection}},[e._v("取消选择")]),e._v("\n        总共 "+e._s(e.totalNum)+" 个服务器，已选择 "+e._s(e.selection.length)+"\n        "),n("search-box",{staticStyle:{float:"right"},on:{enter:e.handleSearch},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.ipList,border:"","header-cell-class-name":"datatable-header"},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{label:"主机名",prop:"host.bk_host_name"}}),e._v(" "),n("el-table-column",{attrs:{label:"内网IP",prop:"host.bk_host_innerip"}}),e._v(" "),n("el-table-column",{attrs:{label:"外网IP",prop:"host.bk_host_outerip"}}),e._v(" "),n("el-table-column",{attrs:{label:"云区域",prop:"host.bk_cloud_id[0].bk_inst_name"}})],1),e._v(" "),n("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,"page-sizes":[2,10,20,30,40,50,100],total:e.totalNum,background:"",layout:"prev, pager, next, sizes, total, jumper"},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1),e._v(" "),n("el-tab-pane",{attrs:{label:"配置平台",lazy:"",name:"topo"}},[n("el-tree",{ref:"topoTree",attrs:{"default-expanded-keys":e.defaultExpandKeys,load:e.loadNode,props:{children:"child",label:"bk_inst_name"},lazy:"","node-key":"bk_inst_id","show-checkbox":""}})],1),e._v(" "),n("el-tab-pane",{attrs:{label:"手动添加",lazy:"",name:"input"}},[e._v("\n      云区域名称:\n      "),n("el-select",{model:{value:e.bk_cloud_id,callback:function(t){e.bk_cloud_id=t},expression:"bk_cloud_id"}},e._l(e.bk_clouds,function(e){return n("el-option",{key:e.bk_inst_id,attrs:{label:e.bk_inst_name,value:e.bk_inst_id}})}),1),e._v(" "),n("el-input",{attrs:{placeholder:"请填写IP，每行一个",type:"textarea"},model:{value:e.ipStr,callback:function(t){e.ipStr=t},expression:"ipStr"}})],1)],1),e._v(" "),n("div",{staticStyle:{padding:"10px 0 0 10px"}},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)},v=[],j=(n("386d"),n("e814")),k=n.n(j),y=(n("28a5"),n("ac6a"),n("774e")),x=n.n(y),S=n("b6d0"),w=n.n(S),z=(n("c5f6"),n("d0f7"));function C(e,t){return I.apply(this,arguments)}function I(){return I=Object(o["a"])(regeneratorRuntime.mark(function e(t,n){var a,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=n.pageSize,i=n.pageStart,s=n.ip,e.abrupt("return",Object(z["a"])({url:"./api/cmdb/search_host/",timeout:6e4,params:{biz_id:t,page_limit:a,page_start:i,ip:s}}));case 4:case"end":return e.stop()}},e)})),I.apply(this,arguments)}function O(e,t){return H.apply(this,arguments)}function H(){return H=Object(o["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(z["a"])({url:"./api/cmdb/search_host2/",timeout:6e4,params:{biz_id:t},method:"post",data:n}));case 1:case"end":return e.stop()}},e)})),H.apply(this,arguments)}function $(e){return D.apply(this,arguments)}function D(){return D=Object(o["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(z["a"])({url:"./api/cmdb/search_biz_inst_topo/",params:{biz_id:t}}));case 1:case"end":return e.stop()}},e)})),D.apply(this,arguments)}var P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"search"},[n("el-button",{staticClass:"rounded-button search-icon",attrs:{circle:"",icon:"el-icon-search",size:"mini"},on:{click:e.handleShowSearch}}),e._v(" "),n("el-input",{ref:"search_input",staticClass:"search-input",class:{show:e.show},attrs:{placeholder:"搜索"},on:{input:e.handleChange},nativeOn:{focusout:function(t){e.show=e.currentValue.length>0},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleEnter(t)}},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}})],1)},T=[],E={name:"SearchBox",model:{prop:"value",event:"input"},props:{value:{type:String,default:""}},data:function(){return{show:!1,currentValue:this.value}},watch:{value:function(e){this.currentValue=e}},methods:{handleShowSearch:function(){this.show=!this.show,this.show&&this.$refs.search_input.focus()},handleChange:function(e){this.$emit("input",e)},handleEnter:function(){this.$emit("enter",this.currentValue)}}},B=E,R=(n("edaa"),n("2877")),V=Object(R["a"])(B,P,T,!1,null,"2d7acf05",null),L=V.exports,N={name:"IpSelect",components:{SearchBox:L},props:{bizId:{type:Number,default:0},appendToBody:{type:Boolean,default:!1},limit:{type:Number,default:-1}},computed:Object(l["a"])({},Object(c["b"])(["currBiz"]),{pageStart:function(){return(this.currentPage-1)*this.pageSize}}),watch:{ipList:function(){this.buildCloud()},pageSize:function(){1===this.currentPage?this.loadIPList():this.currentPage=1},currentPage:function(){this.loadIPList()}},created:function(){var e=this;$(this.currBiz).then(function(t){e.defaultExpandKeys=[];var n=[].concat(t);while(n.length>0){var a=n[0];n=n.slice(1),e.defaultExpandKeys.push(a.bk_inst_id),a.child&&"app"!==a.bk_obj_id&&(n=n.concat(a.child))}console.log(t,e.defaultExpandKeys)})},data:function(){return{loading:!0,visible:!1,ipStr:"",ipList:[],selection:[],currentTab:"ip",currentPage:1,totalNum:0,pageSize:10,bk_clouds:[],bk_cloud_id:-1,search:"",currentSearch:"",defaultExpandKeys:[]}},methods:{show:function(){this.visible=!0},handleOpen:function(){this.loadIPList()},loadIPList:function(){var e=this;C(this.currBiz,{ip:this.currentSearch,pageSize:this.pageSize,pageStart:this.pageStart}).then(function(t){e.loading=!1,e.totalNum=t.count,e.ipList=t.info})},buildCloud:function(){var e=this,t=[];t.push({bk_inst_name:"自动",bk_inst_id:-1});for(var n=function(){var n=e.ipList[a],i=n["host"]["bk_cloud_id"][0],s=t.find(function(e){return e.bk_inst_id===i.bk_inst_id});void 0===s&&t.push(i)},a=0;a<this.ipList.length;++a)n();this.bk_clouds=t},handleSelectionChange:function(e){this.selection=e},getSelection:function(e){var t=this,n=[];switch(this.currentTab){case"ip":return n=this.selection,void e(n);case"topo":var a=this.$refs.topoTree.getCheckedNodes(),i=new w.a;while(a.length>0){var s=a.shift();"module"===s.bk_obj_id&&i.add(s.bk_inst_id),a=a.concat(s.child)}return void O(this.currBiz,{condition:[{bk_obj_id:"module",condition:[{field:"bk_module_id",operator:"$in",value:x()(i)}]}]}).then(function(a){var i=new w.a;n=t.$refs.topoTree.getCheckedNodes().filter(function(e){return!0===e["is_host"]}),n.forEach(function(e){i.add(e.host.bk_cloud_id[0].id+":"+e.host.bk_host_innerip)}),a.info.forEach(function(e){i.has(e.host.bk_cloud_id[0].id+":"+e.host.bk_host_innerip)||n.push(e)}),e(n)});case"input":var r=this.ipStr.trim().split("\n");return void O(this.currBiz,{ip:{data:r,exact:1,flag:"bk_host_innerip|bk_host_outerip"},condition:[{bk_obj_id:"biz",condition:[{field:"bk_biz_id",operator:"$eq",value:k()(this.currBiz)}]}]}).then(function(n){var a=new w.a,i=[],s=[],o=function(e){a.has(e)?i.push(e):a.add(e)},l=function(e){a.has(e)||s.push(e)};n.info.map(function(e){""!==e.host.bk_host_innerip&&o(e.host.bk_host_innerip),""!==e.host.bk_host_outerip&&o(e.host.bk_host_outerip)});if(r.forEach(function(e){return l(e)}),i.length>0||s.length>0){var c="";i.length>0&&(c+="重复的IP: ".concat(i.join(","),"\n")),s.length>0&&(c+="未找到的IP: ".concat(s.join(","),"\n")),t.$message.error(c)}else e(n.info)})}},handleSubmit:function(){var e=this;this.getSelection(function(t){if(void 0!==t){if(e.limit>0&&t.length>e.limit)return void e.$message({message:"最多选择".concat(e.limit,"个IP, 请重新输入"),type:"error"});e.$emit("pickDetail",t);var n=t.map(function(e){return{bk_cloud_id:e.host.bk_cloud_id[0].bk_inst_id,ip:e.host.bk_host_innerip}});e.$emit("pick",n),e.visible=!1}})},selectAll:function(){var e=this;this.loading=!0,this.$refs.table.clearSelection(),this.$refs.table.toggleAllSelection(),C(this.currBiz,{ip:this.currentSearch,pageSize:0,pageStart:0}).then(function(t){e.loading=!1,e.selection=t.info})},clearSelection:function(){this.$refs.table.clearSelection()},handleSearch:function(){this.currentSearch=this.search,this.loadIPList()},loadNode:function(e,t){void 0===e.data?$(this.currBiz).then(function(e){t(e)}):e.data.isLeaf?t([]):"module"!==e.data.bk_obj_id?t(e.data.child):C(this.currBiz,{condition:[{bk_obj_id:"module",condition:[{field:"bk_module_id",operator:"$eq",value:e.data.bk_module_id}]}]}).then(function(e){return t(e.info.map(function(e){return Object(l["a"])({bk_inst_name:"".concat(e.host.bk_host_name,"[").concat(e.host.bk_host_innerip,"]"),is_host:!0,isLeaf:!0},e)}))})}}},M=N,q=Object(R["a"])(M,_,v,!1,null,"fb92b388",null),A=q.exports,F={job_uuid:"",bk_biz:0,title:"",module:"default",exec_ip:"[]",username:"root",callback:"",script_name:"",create_time:""},J={name:"TaskDetails",props:{},computed:Object(l["a"])({},Object(c["b"])(["currBiz"])),components:{IpSelect:A},data:function(){return{dialogVisible:!1,settingInfo:g()({},F),hosts:[],hostTableData:[],currentHostPage:1,pageHostSize:5,currentHostTotal:0,searchHost:"",rules:{title:[{required:!0,message:"请输入任务名",trigger:"change"}],username:[{required:!0,message:"请输入执行账户",trigger:"change"}],create_at:[{required:!0,message:"请输入创建时间",trigger:"change"}]}}},watch:{searchHost:function(e,t){var n=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){n.searchHostChange()},300)}},methods:{show:function(e){try{this.$refs["ruleForm"].resetFields()}catch(t){}this.settingInfo=Object(d["b"])(e.row),this.searchHost="",this.hosts=JSON.parse(this.settingInfo.exec_ip),this.searchHostChange(),this.dialogVisible=!0},searchHostChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[];if(""!==this.searchHost){var n=!0,a=!1,i=void 0;try{for(var s,o=r()(this.hosts);!(n=(s=o.next()).done);n=!0){var l=s.value,c=RegExp(this.searchHost);l.ip.match(c)&&t.push(l)}}catch(u){a=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}else t=this.hosts;this.hostTableData=t,this.currentHostTotal=this.hostTableData.length,this.currentHostPage=e,this.pageHostSize*this.currentHostPage>=this.currentHostTotal?this.hostTableData=this.hostTableData.slice((this.currentHostPage-1)*this.pageHostSize,this.currentHostTotal):this.hostTableData=this.hostTableData.slice((this.currentHostPage-1)*this.pageHostSize,this.pageHostSize*this.currentHostPage)},handleHostCurrentChange:function(e){this.searchHostChange(e)},handleHostDelete:function(e){e.$index;var t=e.row,n=(this.hosts.find(function(e){return e.bk_cloud_id===t.bk_cloud_id&&e.ip===t.ip}),null);this.hosts.find(function(e,a){e.bk_cloud_id===t.bk_cloud_id&&e.ip===t.ip&&(n=a)}),this.hosts.splice(n,1),this.currentHostPage>1&&this.hostTableData.length>=2?this.searchHostChange(this.currentHostPage):this.currentHostPage>1&&1===this.hostTableData.length?this.searchHostChange(this.currentHostPage-1):this.searchHostChange()},handleDialogOpen:function(){},handleDialogClose:function(){},handleAddHost:function(){this.$refs.ip_select.show()},SetHosts:function(e){var t=this,n=!0,a=!1,i=void 0;try{for(var s,o=function(){var e=s.value;if(t.hosts.find(function(t){return t.bk_cloud_id===e.bk_cloud_id&&t.ip===e.ip}))return"continue";t.hosts.push(e)},l=r()(e);!(n=(s=l.next()).done);n=!0)o()}catch(c){a=!0,i=c}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}},handlePickIp:function(e){this.SetHosts(e),this.searchHostChange()},confirmSetting:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.settingInfo.exec_ip=b()(this.hosts),e.next=3,Object(u["h"])(this.settingInfo.id,this.settingInfo).then(function(){var e=t.settingInfo.title;t.dialogVisible=!1,t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>更新 :  ".concat(e,"</div>\n          "),type:"success"}),t.$emit("dataRefresh")});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},K=J,U=(n("bde8"),Object(R["a"])(K,h,p,!1,null,"3fc3d2f6",null)),Y=U.exports,W=n("8f94");n("a7be");n("02f0"),n("7393"),n("0109"),n("f6b6"),n("9b74");var G={name:"Job",computed:Object(l["a"])({},Object(c["b"])(["name","role","currBiz"])),components:{codemirror:W["codemirror"],JobEdit:Y},props:{jobModule:{type:String,default:""},jobUuid:{type:String,default:""}},data:function(){return{show:!1,timeout:null,currentPage:1,pageSize:10,filter_uuid_value:"",search_value:"",type_value:"",order_value:"-create_at",currentTotal:0,multipleSelection:[],multipleSelectionCount:0,tableData:[],dialogScriptVisible:!1,dialogType:"new",loading:!0,template_value:[],content:"",cmOptions:{tabSize:4,mode:"shell",theme:"dracula",lineNumbers:!0,lineWrapping:!0,lineWiseCopyCut:!0,highlightDifferences:!0,smartIndent:!0,matchBrackets:!0,extraKeys:{Ctrl:"autocomplete"},indentWithTabs:!0,line:!0},type_options:[{value:"script",label:"快速脚本"},{value:"template",label:"作业模板"}],column_rules:{id:!0,job_uuid:!0,title:!0,module:!0,username:!0,script_name:!1,create_time:!0}}},watch:{type_value:function(e){this.currentPage=1,this.getDatas()},show:function(e){e?document.body.addEventListener("click",this.close):document.body.removeEventListener("click",this.close)},search_value:function(e,t){var n=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){n.searchChange()},300)}},created:function(){this.getDatas()},methods:{click:function(){this.show=!this.show,this.show&&this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.focus()},close:function(){this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.blur(),this.options=[],this.show=!1},base64Decode:function(e){var t=n("27ae").Base64;return t.decode(e)},base64Encode:function(e){var t=n("27ae").Base64;return t.encode(e)},getDateTime:function(){var e=n("c1df");return e().format("YYYY-MM-DD HH:mm:ss")},getDatas:function(){var e=this;this.loading=!0,Object(u["c"])({page:this.currentPage,page_size:this.pageSize,bk_biz:this.currBiz,search:this.search_value,ordering:this.order_value,job_uuid:this.job_uuid,module:this.job_module,type:this.filter_job_type_vaule}).then(function(t){e.currentTotal=t.count,e.tableData=t.results,e.loading=!1})},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getDatas()},handleCurrentChange:function(e){this.currentPage=e,this.getDatas()},searchChange:function(){this.currentPage=1,this.getDatas()},sortChange:function(e,t,n){"ascending"===e.order?this.order_value=e.prop:"descending"===e.order?this.order_value="-"+e.prop:this.order_value="",this.currentPage=1,this.getDatas()},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelectionCount=this.multipleSelection.length},uuid:function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},handleAdd:function(){var e=this;Object(u["g"])({bk_biz:this.currBiz}).then(function(t){e.currentPage=1,e.getDatas(),e.$message({type:"success",message:"注册成功!"})})},handleDelete:function(e){var t=this,n=(e.$index,e.row);this.$confirm("确定删除规则?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["b"])(n.id);case 2:return t.currentPage=1,e.next=5,t.getDatas();case 5:t.$message({type:"success",message:"删除成功!"});case 6:case"end":return e.stop()}},e)}))).catch(function(e){console.error(e)})},handleMultipleDelete:function(){var e=this;this.multipleSelection.length>0?this.$confirm("确定删除规则?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark(function t(){var n,a,i,s,o,l;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=!0,a=!1,i=void 0,t.prev=3,s=r()(e.multipleSelection);case 5:if(n=(o=s.next()).done){t.next=15;break}return l=o.value,t.next=9,Object(u["b"])(l.id);case 9:return e.currentPage=1,t.next=12,e.getDatas();case 12:n=!0,t.next=5;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](3),a=!0,i=t.t0;case 21:t.prev=21,t.prev=22,n||null==s.return||s.return();case 24:if(t.prev=24,!a){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(21);case 29:e.multipleSelection=[],e.$message({type:"success",message:"删除成功!"});case 31:case"end":return t.stop()}},t,null,[[3,17,21,29],[22,,24,28]])}))).catch(function(e){console.error(e)}):this.$message("请选择要删除的行.")},handleEdit:function(e){this.$refs.job_edit.show(e)},handleScriptEdit:function(e){this.settingInfo=Object(d["b"])(e.row),this.content="",this.settingInfo.script&&(this.content=this.base64Decode(this.settingInfo.script)),this.dialogScriptVisible=!0},confirmScript:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return""!==this.content?this.settingInfo.script=this.base64Encode(this.content):this.settingInfo.script=null,e.next=3,Object(u["h"])(this.settingInfo.id,this.settingInfo);case 3:t=this.settingInfo.title,this.dialogScriptVisible=!1,this.getDatas(),this.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>更新 :  ".concat(t,"</div>\n          "),type:"success"});case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),confirmSetting:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["a"])(this.settingInfo).then(function(){t.currentPage=1,t.getDatas();var e=t.settingInfo.title;t.dialogVisible=!1,t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>".concat(type," :  ").concat(e,"</div>\n          "),type:"success"})});case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleRefresh:function(){this.getDatas()},handleFilterChange:function(e){for(var t in e)"job_type"===t&&(0!==e[t].length?this.filter_job_type_vaule=e[t][0]:this.filter_job_type_vaule="");this.currentPage=1,this.getDatas()}}},Q=G,X=(n("0631"),Object(R["a"])(Q,a,i,!1,null,"50dce257",null));t["a"]=X.exports},"8f1a":function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"e",function(){return s}),n.d(t,"c",function(){return r}),n.d(t,"b",function(){return o}),n.d(t,"a",function(){return l}),n.d(t,"h",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"g",function(){return d});var a=n("d0f7");function i(e){return Object(a["a"])({url:"./task/taskinstance/"+e+"/",method:"get"})}function s(e){return Object(a["a"])({url:"./task/taskinstance/",method:"get",params:e})}function r(e){return Object(a["a"])({url:"./task/job/",method:"get",params:e})}function o(e){return Object(a["a"])({url:"./task/job/"+e+"/",method:"delete"})}function l(e){return Object(a["a"])({url:"./task/job/",method:"post",data:e})}function c(e,t){return Object(a["a"])({url:"./task/job/"+e+"/",method:"put",data:t})}function u(e){return Object(a["a"])({url:"./task/log/"+e+"/",method:"get"})}function d(e){return Object(a["a"])({url:"./task/register/",method:"post",data:e})}},ad0e:function(e,t,n){},bde8:function(e,t,n){"use strict";var a=n("e681"),i=n.n(a);i.a},cd4a:function(e,t,n){},e681:function(e,t,n){},edaa:function(e,t,n){"use strict";var a=n("cd4a"),i=n.n(a);i.a}}]);