(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b68d73cc"],{"42f1":function(e,t,n){},"469a":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix"},[n("div",{staticClass:"table-head-container"},[n("div",{staticStyle:{float:"left"},attrs:{align:"left"}},[n("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("\n            添加\n          ")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger",plain:""},on:{click:e.handleMultipleDelete}},[e._v("删除\n          ")]),e._v(" "),n("p",{staticStyle:{"padding-left":"20px",display:"inline","font-size":"13px",color:"#999"}},[e._v(e._s(e.currentTotal)+"个中\n            "+e._s(e.multipleSelectionCount)+" 个被选中")])],1),e._v(" "),n("div",{staticClass:"right-menu",attrs:{align:"right"}},[n("div",{staticClass:"header-search",class:{show:e.show}},[n("svg-icon",{attrs:{"class-name":"search-icon","icon-class":"search"},on:{click:function(t){return t.stopPropagation(),e.click(t)}}}),e._v(" "),n("el-input",{ref:"headerSearchSelect",staticClass:"header-search-select",attrs:{placeholder:"搜索"},model:{value:e.search_value,callback:function(t){e.search_value=t},expression:"search_value"}})],1),e._v(" "),n("el-button",{staticClass:"header-refresh",attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.handleRefresh}}),e._v(" "),n("el-dropdown",{staticStyle:{bottom:"5px"},attrs:{"hide-on-click":!1}},[n("el-button",{staticStyle:{transform:"rotate(90deg)",background:"transparent","border-style":"none",outline:"none","font-size":"18px"},attrs:{icon:"el-icon-more-outline",circle:""}}),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.id,callback:function(t){e.$set(e.column_rules,"id",t)},expression:"column_rules.id"}},[e._v("ID")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.name,callback:function(t){e.$set(e.column_rules,"name",t)},expression:"column_rules.name"}},[e._v("名字")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.group,callback:function(t){e.$set(e.column_rules,"group",t)},expression:"column_rules.group"}},[e._v("用户组")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.description,callback:function(t){e.$set(e.column_rules,"description",t)},expression:"column_rules.description"}},[e._v("描述")])],1)],1)],1)],1)]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"releaseTable",staticStyle:{width:"100%"},attrs:{id:"datatable",border:"",data:e.roleTableData,"header-cell-style":{background:"#f2f2f2",padding:"10px 0 10px 5px",color:"#666","font-size":"14px","font-weight":400},"cell-style":{padding:"7px 0 7px 5px",color:"#666","font-size":"14px","font-weight":400}},on:{"sort-change":e.sortChange,"filter-change":e.handleFilterChange,"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"48"}}),e._v(" "),e.column_rules.id?n("el-table-column",{attrs:{prop:"id",label:"ID",sortable:"",width:"80"}}):e._e(),e._v(" "),e.column_rules.name?n("el-table-column",{attrs:{prop:"name",label:"名字",width:"180"}}):e._e(),e._v(" "),e.column_rules.group?n("el-table-column",{attrs:{prop:"group_name",label:"用户组"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.group_name,function(t){return n("el-tag",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t))])})}}],null,!1,1560430176)}):e._e(),e._v(" "),e.column_rules.description?n("el-table-column",{attrs:{prop:"description",label:"描述",width:"220"}}):e._e(),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(n){return e.handleEdit(t)}}},[e._v("编辑\n            ")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(n){return e.handleDelete(t)}}},[e._v("删除\n            ")])]}}])})],1),e._v(" "),n("div",{staticStyle:{height:"50px","margin-bottom":"10px",padding:"10px","line-height":"22px","border-radius":"0 0 4px 4px","border-color":"#dfe6ec","border-width":"0 1px 1px 1px","border-style":"solid"}},[n("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total, jumper","current-page":e.currentPage,"page-sizes":[5,10,15,20],"page-size":e.pageSize,total:e.currentTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑":"新增","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"ruleForm",attrs:{model:e.settingInfo,rules:e.rules,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"名字",prop:"name"}},[n("el-input",{attrs:{placeholder:"名字"},model:{value:e.settingInfo.name,callback:function(t){e.$set(e.settingInfo,"name",t)},expression:"settingInfo.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"用户组"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择用户组",loading:e.loading},model:{value:e.settingInfo.group,callback:function(t){e.$set(e.settingInfo,"group",t)},expression:"settingInfo.group"}},e._l(e.groups,function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"路由"}},[n("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{"check-strictly":e.checkStrictly,data:e.routesData,props:e.defaultProps,"show-checkbox":"","node-key":"path"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"描述"},model:{value:e.settingInfo.description,callback:function(t){e.$set(e.settingInfo,"description",t)},expression:"settingInfo.description"}})],1)],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmSetting}},[e._v("\n        确认\n      ")])],1)],1)],1)},i=[],a=n("f499"),s=n.n(a),o=n("5d73"),l=n.n(o),c=(n("7f7f"),n("ac6a"),n("20d6"),n("96cf"),n("3b8d")),u=n("5176"),d=n.n(u),h=n("cebc"),p=n("2f62"),g=n("09ac"),f=(n("60cc"),n("2d6e")),m=(n("42ee"),n("8da5")),b=(n("6f8c"),n("716d")),v={id:0,biz_id:0,name:"",group:[],routes:[],group_name:[],description:""},_={name:"Route",components:{},computed:Object(h["a"])({},Object(p["b"])(["name","role","currBiz"]),{routesData:function(){return this.routes}}),data:function(){return{show:!1,timeout:null,loading:!0,currentPage:1,pageSize:10,search_value:"",order_value:"-id",filter_name:"",currentTotal:0,multipleSelection:[],multipleSelectionCount:0,roleTableData:[],permissionObj:{},settingInfo:d()({},v),groups:[],routes:[],options:[],roleSettings:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},rules:{name:[{required:!0,message:"请输入名字",trigger:"change"}]},column_rules:{id:!0,name:!0,group:!0,routes:!0,description:!0}}},watch:{show:function(e){e?document.body.addEventListener("click",this.close):document.body.removeEventListener("click",this.close)},search_value:function(e,t){var n=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){n.searchChange()},300)}},created:function(){this.getRoutes(),this.getRouteTableDatas(),this.getAllGroups()},methods:{handleRefresh:function(){this.currentPage=1,this.getRouteTableDatas()},click:function(){this.show=!this.show,this.show&&this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.focus()},close:function(){this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.blur(),this.options=[],this.show=!1},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getRouteTableDatas()},handleCurrentChange:function(e){this.currentPage=e,this.getRouteTableDatas()},searchChange:function(){this.currentPage=1,this.getRouteTableDatas()},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelectionCount=this.multipleSelection.length},sortChange:function(e,t,n){"ascending"===e.order?this.order_value=e.prop:"descending"===e.order?this.order_value="-"+e.prop:this.order_value="",this.currentPage=1,this.getRouteTableDatas()},getRouteTableDatas:function(){var e=this;this.loading=!0,Object(m["h"])({page:this.currentPage,page_size:this.pageSize,search:this.search_value,ordering:this.order_value,biz_id:this.currBiz,name:this.filter_name}).then(function(t){e.currentTotal=t.count,e.roleTableData=t.results,e.loading=!1})},formatterGroup:function(e,t){return e.group.length},formatterRoute:function(e,t){return JSON.parse(e.routes).length},getRoutes:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=f["a"],e.next=3,Object(b["a"])();case 3:e.t1=e.sent,this.routes=(0,e.t0)(e.t1),t=this.routes.findIndex(function(e){return"/permission"===e.path}),-1!==t&&(this.permissionObj=this.routes.splice(t,1));case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),generateCheckedRoutes:function(e){var t=[];return e&&JSON.parse(e).forEach(function(e){t.push({path:e})}),t},handleAdd:function(){this.settingInfo=d()({},v),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]);try{this.$refs["ruleForm"].resetFields()}catch(e){}this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){var t=this;this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.settingInfo=Object(g["b"])(e.row),this.$nextTick(function(){var e=t.generateCheckedRoutes(t.settingInfo.routes);t.$refs.tree.setCheckedNodes(e),t.checkStrictly=!1})},handleDelete:function(e){var t=this,n=(e.$index,e.row);this.$confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(m["d"])(n.id);case 2:return t.currentPage=1,e.next=5,t.getRouteTableDatas();case 5:t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>删除 :  ".concat(n.name,"</div>\n          "),type:"success"});case 6:case"end":return e.stop()}},e)}))).catch(function(e){console.error(e)})},handleMultipleDelete:function(){var e=this;this.multipleSelection.length>0?this.$confirm("确定删除规则?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(regeneratorRuntime.mark(function t(){var n,r,i,a,s,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=!0,r=!1,i=void 0,t.prev=3,a=l()(e.multipleSelection);case 5:if(n=(s=a.next()).done){t.next=15;break}return o=s.value,t.next=9,Object(m["d"])(o.id);case 9:return e.currentPage=1,t.next=12,e.getRouteTableDatas();case 12:n=!0,t.next=5;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](3),r=!0,i=t.t0;case 21:t.prev=21,t.prev=22,n||null==a.return||a.return();case 24:if(t.prev=24,!r){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(21);case 29:e.multipleSelection=[],e.$message({type:"success",message:"删除成功!"});case 31:case"end":return t.stop()}},t,null,[[3,17,21,29],[22,,24,28]])}))).catch(function(e){console.error(e)}):this.$message("请选择要删除的行.")},confirmSetting:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["ruleForm"].validate(function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(n){var r,i,a,o,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r="添加",i="edit"===t.dialogType,a=t.$refs.tree.getCheckedKeys(),o=t.$refs.tree.getHalfCheckedKeys(),t.settingInfo.routes=s()(o.concat(a)),!i){e.next=11;break}return r="更新",e.next=9,Object(m["j"])(t.settingInfo.id,t.settingInfo);case 9:e.next=14;break;case 11:return t.settingInfo.biz_id=t.currBiz,e.next=14,Object(m["b"])(t.settingInfo);case 14:t.currentPage=1,t.getRouteTableDatas(),l=t.settingInfo.name,t.dialogVisible=!1,t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n             <div>".concat(r," :  ").concat(l,"</div>\n          "),type:"success"});case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getAllGroups:function(){var e=this;Object(m["e"])(this.currBiz).then(function(t){e.groups=t})}}},x=_,w=(n("d354"),n("2877")),k=Object(w["a"])(x,r,i,!1,null,"588f5170",null);t["default"]=k.exports},d354:function(e,t,n){"use strict";var r=n("42f1"),i=n.n(r);i.a}}]);