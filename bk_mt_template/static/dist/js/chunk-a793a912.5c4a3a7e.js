(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a793a912"],{a292:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix"},[n("div",{staticClass:"table-head-container"},[n("div",{staticStyle:{float:"left"},attrs:{align:"left"}},[n("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("\n            添加\n          ")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger",plain:""},on:{click:e.handleMultipleDelete}},[e._v("删除\n          ")]),e._v(" "),n("p",{staticStyle:{"padding-left":"20px",display:"inline","font-size":"13px",color:"#999"}},[e._v(e._s(e.currentTotal)+"个中\n            "+e._s(e.multipleSelectionCount)+" 个被选中")])],1),e._v(" "),n("div",{staticClass:"right-menu",attrs:{align:"right"}},[n("div",{staticClass:"header-search",class:{show:e.show}},[n("svg-icon",{attrs:{"class-name":"search-icon","icon-class":"search"},on:{click:function(t){return t.stopPropagation(),e.click(t)}}}),e._v(" "),n("el-input",{ref:"headerSearchSelect",staticClass:"header-search-select",attrs:{placeholder:"搜索"},model:{value:e.search_value,callback:function(t){e.search_value=t},expression:"search_value"}})],1),e._v(" "),n("el-button",{staticClass:"header-refresh",attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.handleRefresh}}),e._v(" "),n("el-dropdown",{staticStyle:{bottom:"5px"},attrs:{"hide-on-click":!1}},[n("el-button",{staticStyle:{transform:"rotate(90deg)",background:"transparent","border-style":"none",outline:"none","font-size":"18px"},attrs:{icon:"el-icon-more-outline",circle:""}}),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.id,callback:function(t){e.$set(e.column_rules,"id",t)},expression:"column_rules.id"}},[e._v("ID")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.name,callback:function(t){e.$set(e.column_rules,"name",t)},expression:"column_rules.name"}},[e._v("组名")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.users,callback:function(t){e.$set(e.column_rules,"users",t)},expression:"column_rules.users"}},[e._v("用户")])],1),e._v(" "),n("el-dropdown-item",[n("el-checkbox",{model:{value:e.column_rules.description,callback:function(t){e.$set(e.column_rules,"description",t)},expression:"column_rules.description"}},[e._v("描述")])],1)],1)],1)],1)]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"releaseTable",staticStyle:{width:"100%"},attrs:{id:"datatable",border:"",data:e.groupTableData,"header-cell-style":{background:"#f2f2f2",padding:"10px 0 10px 5px",color:"#666","font-size":"14px","font-weight":400},"cell-style":{padding:"7px 0 7px 5px",color:"#666","font-size":"14px","font-weight":400}},on:{"sort-change":e.sortChange,"filter-change":e.handleFilterChange,"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"48"}}),e._v(" "),e.column_rules.id?n("el-table-column",{attrs:{prop:"id",label:"ID",sortable:"",width:"80"}}):e._e(),e._v(" "),e.column_rules.name?n("el-table-column",{attrs:{prop:"name",label:"组名",width:"120"}}):e._e(),e._v(" "),e.column_rules.users?n("el-table-column",{attrs:{prop:"user_list",label:"用户"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.user_list,function(t){return n("el-tag",{staticStyle:{"margin-right":"5px"}},[e._v(e._s(t))])})}}],null,!1,1662285195)}):e._e(),e._v(" "),e.column_rules.description?n("el-table-column",{attrs:{prop:"description",label:"描述",width:"200"}}):e._e(),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(n){return e.handleEdit(t)}}},[e._v("编辑\n            ")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(n){return e.handleDelete(t)}}},[e._v("删除\n            ")])]}}])})],1),e._v(" "),n("div",{staticStyle:{height:"50px","margin-bottom":"10px",padding:"10px","line-height":"22px","border-radius":"0 0 4px 4px","border-color":"#dfe6ec","border-width":"0 1px 1px 1px","border-style":"solid"}},[n("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes, total, jumper","current-page":e.currentPage,"page-sizes":[5,10,15,20],"page-size":e.pageSize,total:e.currentTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑":"新增","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"ruleForm",attrs:{model:e.settingInfo,rules:e.rules,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"组名",prop:"name"}},[n("el-input",{attrs:{placeholder:"组名"},model:{value:e.settingInfo.name,callback:function(t){e.$set(e.settingInfo,"name",t)},expression:"settingInfo.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"用户"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入用户名","remote-method":e.remoteMethod,loading:e.loading},model:{value:e.settingInfo.users,callback:function(t){e.$set(e.settingInfo,"users",t)},expression:"settingInfo.users"}},e._l(e.options,function(e){return n("el-option",{key:e.bk_username,attrs:{label:e.bk_username,value:e.bk_username}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"组描述"},model:{value:e.settingInfo.description,callback:function(t){e.$set(e.settingInfo,"description",t)},expression:"settingInfo.description"}})],1)],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirmSetting}},[e._v("\n        确认\n      ")])],1)],1)],1)},r=[],a=n("f499"),s=n.n(a),l=n("5d73"),o=n.n(l),c=(n("7f7f"),n("96cf"),n("3b8d")),u=(n("ac6a"),n("5176")),d=n.n(u),h=n("cebc"),p=n("2f62"),g=n("09ac"),f=(n("60cc"),n("2d6e"),n("42ee"),n("8da5")),m=n("6f8c"),b={id:0,biz_id:0,name:"",users:"",user_list:[],description:""},v={name:"Role",components:{},computed:Object(h["a"])({},Object(p["b"])(["name","role","currBiz"])),data:function(){return{show:!1,timeout:null,loading:!0,currentPage:1,pageSize:10,search_value:"",order_value:"-id",filter_name:"",currentTotal:0,multipleSelection:[],multipleSelectionCount:0,groupTableData:[],permissionObj:{},settingInfo:d()({},b),users:[],routes:[],options:[],roleSettings:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},rules:{name:[{required:!0,message:"请输入角色名",trigger:"change"}]},column_rules:{id:!0,name:!0,users:!0,description:!0}}},watch:{show:function(e){e?document.body.addEventListener("click",this.close):document.body.removeEventListener("click",this.close)},search_value:function(e,t){var n=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){n.searchChange()},300)}},created:function(){this.getGroupTableDatas(),this.getAllUsers()},methods:{handleRefresh:function(){this.currentPage=1,this.getGroupTableDatas()},click:function(){this.show=!this.show,this.show&&this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.focus()},close:function(){this.$refs.headerSearchSelect&&this.$refs.headerSearchSelect.blur(),this.options=[],this.show=!1},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getGroupTableDatas()},handleCurrentChange:function(e){this.currentPage=e,this.getGroupTableDatas()},searchChange:function(){this.currentPage=1,this.getGroupTableDatas()},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelectionCount=this.multipleSelection.length},sortChange:function(e,t,n){"ascending"===e.order?this.order_value=e.prop:"descending"===e.order?this.order_value="-"+e.prop:this.order_value="",this.currentPage=1,this.getGroupTableDatas()},getGroupTableDatas:function(){var e=this;this.loading=!0,Object(f["f"])({page:this.currentPage,page_size:this.pageSize,search:this.search_value,ordering:this.order_value,biz_id:this.currBiz,name:this.filter_name}).then(function(t){e.currentTotal=t.count,e.groupTableData=t.results,e.loading=!1})},generateUsers:function(e){var t=[];return e&&JSON.parse(e).forEach(function(e){t.push({bk_username:e})}),t},handleAdd:function(){this.settingInfo=d()({},b);try{this.$refs["ruleForm"].resetFields()}catch(e){}this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){this.dialogType="edit",this.dialogVisible=!0,this.settingInfo=Object(g["b"])(e.row),this.settingInfo.users=JSON.parse(this.settingInfo.users)},handleDelete:function(e){var t=this,n=(e.$index,e.row);this.$confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(f["c"])(n.id);case 2:return t.currentPage=1,e.next=5,t.getGroupTableDatas();case 5:t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>删除 :  ".concat(n.name,"</div>\n          "),type:"success"});case 6:case"end":return e.stop()}},e)}))).catch(function(e){console.error(e)})},handleMultipleDelete:function(){var e=this;this.multipleSelection.length>0?this.$confirm("确定删除规则?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(regeneratorRuntime.mark(function t(){var n,i,r,a,s,l;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=!0,i=!1,r=void 0,t.prev=3,a=o()(e.multipleSelection);case 5:if(n=(s=a.next()).done){t.next=15;break}return l=s.value,t.next=9,Object(f["c"])(l.id);case 9:return e.currentPage=1,t.next=12,e.getGroupTableDatas();case 12:n=!0,t.next=5;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](3),i=!0,r=t.t0;case 21:t.prev=21,t.prev=22,n||null==a.return||a.return();case 24:if(t.prev=24,!i){t.next=27;break}throw r;case 27:return t.finish(24);case 28:return t.finish(21);case 29:e.multipleSelection=[],e.$message({type:"success",message:"删除成功!"});case 31:case"end":return t.stop()}},t,null,[[3,17,21,29],[22,,24,28]])}))).catch(function(e){console.error(e)}):this.$message("请选择要删除的行.")},confirmSetting:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["ruleForm"].validate(function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(n){var i,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i="添加",r="edit"===t.dialogType,t.settingInfo.users=s()(t.settingInfo.users),!r){e.next=9;break}return i="更新",e.next=7,Object(f["i"])(t.settingInfo.id,t.settingInfo);case 7:e.next=12;break;case 9:return t.settingInfo.biz_id=t.currBiz,e.next=12,Object(f["a"])(t.settingInfo);case 12:t.currentPage=1,t.getGroupTableDatas(),a=t.settingInfo.name,t.dialogVisible=!1,t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n             <div>".concat(i," :  ").concat(a,"</div>\n          "),type:"success"});case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),remoteMethod:function(e){var t=this;""!==e?(this.loading=!0,setTimeout(function(){t.loading=!1,t.options=t.users.filter(function(t){return t.bk_username.toLowerCase().indexOf(e.toLowerCase())>-1})},200)):this.options=[]},getAllUsers:function(){var e=this;Object(m["a"])().then(function(t){e.users=t})}}},_=v,x=(n("d88d"),n("2877")),w=Object(x["a"])(_,i,r,!1,null,"194a172c",null);t["default"]=w.exports},d88d:function(e,t,n){"use strict";var i=n("f619"),r=n.n(i);r.a},f619:function(e,t,n){}}]);